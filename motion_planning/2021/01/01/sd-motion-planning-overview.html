<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Motion Planning for Self-Driving Cars | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Motion Planning for Self-Driving Cars" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Motion Planning for Self-Driving Cars" />
<meta property="og:description" content="Motion Planning for Self-Driving Cars" />
<link rel="canonical" href="https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html" />
<meta property="og:url" content="https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-01T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Motion Planning for Self-Driving Cars","dateModified":"2021-01-01T00:00:00-06:00","datePublished":"2021-01-01T00:00:00-06:00","description":"Motion Planning for Self-Driving Cars","mainEntityOfPage":{"@type":"WebPage","@id":"https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html"},"@type":"BlogPosting","url":"https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://fspirit.github.io/blog/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Motion Planning for Self-Driving Cars | fastpages</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Motion Planning for Self-Driving Cars" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Motion Planning for Self-Driving Cars" />
<meta property="og:description" content="Motion Planning for Self-Driving Cars" />
<link rel="canonical" href="https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html" />
<meta property="og:url" content="https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-01T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Motion Planning for Self-Driving Cars","dateModified":"2021-01-01T00:00:00-06:00","datePublished":"2021-01-01T00:00:00-06:00","description":"Motion Planning for Self-Driving Cars","mainEntityOfPage":{"@type":"WebPage","@id":"https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html"},"@type":"BlogPosting","url":"https://fspirit.github.io/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://fspirit.github.io/blog/feed.xml" title="fastpages" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Motion Planning for Self-Driving Cars</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-01T00:00:00-06:00" itemprop="datePublished">
        Jan 1, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#motion_planning">motion_planning</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#motion-planning-for-self-driving-cars">Motion Planning for Self-Driving Cars</a>
<ul>
<li class="toc-entry toc-h3"><a href="#route-planning">Route Planning</a></li>
<li class="toc-entry toc-h3"><a href="#maneuver-planning">Maneuver Planning</a></li>
<li class="toc-entry toc-h3"><a href="#trajectory-planning">Trajectory Planning</a></li>
</ul>
</li>
</ul><h2 id="motion-planning-for-self-driving-cars">
<a class="anchor" href="#motion-planning-for-self-driving-cars" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motion Planning for Self-Driving Cars</h2>

<p>In this series of posts I would like to answer the question: How would we build motion planning component for a self-driving car from scratch using current state of the art approaches.</p>

<p><em>Disclaimer</em>: I’m not a professional researcher  working on this topic, I’m a software developer in the automotive industry, so I will look at different approaches mostly from the perspective of how hard are they to implement and will that implementation lead too satisfying functional &amp; non-functional (runtime) performance. With that in mind, some lack of math/theory can be expected.</p>

<p>First of all let us define a place and function of Motion Planning component/subsystem in the the whole self-driving stack. In the end it must answer a question - where the car goes next 
and produce a trajectory from which actuator values (acceleration and steering curvature) can be derived and
passed to the Control block.</p>

<p>So the input is basically all the data we can gather about environment and our ego car: road data (road geometries, signs), ego odometry data (position, heading, steering angle and rate of change of those values), max allowed and desired speeds, data about other traffic participants (current poses ans predicted trajectories) and obstacles.</p>

<p>As output the component must produce a trajectory, which must be:</p>
<ul>
  <li>Safe, a risk of collision with other vehicles or obstacles should be as low as possible</li>
  <li>Feasible, a car should be able to drive resulting trajectory. For instance, maximum turning angle should be considered</li>
  <li>Comfortable, a driver and/or passengers should feel comfortable while a car drives them. For example, lateral acceleration (which depends on the velocity of the vehicle and curvature of the path it follows) must not exceed a certain limit</li>
</ul>

<p>Usually Motion Planning task is decomposed into 3 stages, which also usually come in order, producing input for the next stage (although for different use cases and/or decision making approaches some of them can be skipped or merged).</p>

<p><img src="/blog/images/MotionPlanning.png" alt=""></p>

<h3 id="route-planning">
<a class="anchor" href="#route-planning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route Planning</h3>

<p>At this stage we look at road graph and, knowing the final destination, construct a path through road segments to reach it. Here the graph search algorithms are employed, Dijkstra, A<em>, D</em> and the like.
The result is a sequence of road segments ego vehicle has to follow.</p>

<h3 id="maneuver-planning">
<a class="anchor" href="#maneuver-planning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maneuver Planning</h3>

<p>Here we look at what kind of manuevers the car can perform to reach the next road segment from the route generated at the previous stage.
Examples for highway scenario can be: keep current lane, change to left, change to right.
Then, depending on approach, we either select one immediately and proceed to generating trajectory or
we generate trajectory for each of possible maneuvers and select one of them, based on some set of criteria.
Here we consider million of factors, like road limits (current speed limit, traffic lights, lane merging/splitting).
Most popular approches here include:</p>
<ul>
  <li>State machines</li>
  <li>Maneuver selection based on cost</li>
  <li>Reinforcement learning (including Deep RL)</li>
</ul>

<h3 id="trajectory-planning">
<a class="anchor" href="#trajectory-planning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Trajectory Planning</h3>

<p>The remark should be made about path and trajectory distinction:
while path contains just geometrical information and is an ordered sequence of poses (x, y, heading, curvature) of the vehicle, a trajectory 
considers time dimension and thus will also entail velocities and accelerations.
One way to get final trajectory is to generate collision-free (including dynamic objects!), feasible path first and then decide on velocity profile to maximize comfort. Another approach would be to try to state and solve a problem, which takes velocities and accelerations into account right away.
Methods here include:</p>
<ul>
  <li>
<strong>Graph-based</strong>. First generate a graph of possible states a vehicle can be in next X seconds, for instance, divide all the space around into geometric shapes like squares or rectangles, assigning cost to each, or using several possible feasible movements recusively build a tree. Then run on top of that one of those graph search algorithms mentioned already: Dijkstra, A<em>, D</em> or their variations.</li>
  <li>
<strong>RTT family</strong>. This algorithms randomly samples next pose for the vehicle and builds a tree with a root at current vehicle state, until it reaches target area.</li>
  <li>
<strong>Numerical optimization</strong>. Here the problem of generating trajectory is stated as an optimal control problem, that is as a cost functional to minimize (which can take different forms), set of variables that can be controlled (acceleration/steering), quality and inequality constraints on those and derived variables. Then we run solvers to get the target variables values, which minimize cost functions and satisfy all the constraints.</li>
  <li>
<strong>Curve Interpolation</strong>. Take a set of fine-grained waypoints (another question is who will generate them) and fit a curve with desired properties using appropriate curve types: splines, spirals, clothoids, Bezier curves and so on.</li>
</ul>

<p>In the next post I’ll go into details of Trajectory Planning step, digging deeper into one or several of the approaches and discussing how they achieve safety/feasibility and comfort properties and how easy to implement/fast are they.</p>


  </div><a class="u-url" href="/blog/motion_planning/2021/01/01/sd-motion-planning-overview.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
